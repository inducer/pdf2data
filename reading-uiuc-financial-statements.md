# Reading UIUC Financial Statements with pdf2data

The script [read-uiuc-fin-statement](read-uiuc-fin-statement) aims to read
financial statements made available through the `my.dept` system.  Possibly,
these are the same as the PDFs generated by My UI Financials and "EDDIE", but I
really don't know. In particular, it is designed to read the

* Operating Ledger Transaction Statement
* Payroll Labor Distribution

reports. It works around the (at least as far as I know)  unavailability of
bulk export of financial information from UI systems. It (currently) works for
me with a 1000-odd page PDF that comes out of the "Customize Combined
Statements" function, for all my active accounts, since "the beginning of
time". As far as I can tell, that includes the entire lifetime of
[XPACC](https://xpacc.illinois.edu/).

If you are lucky, at the end of the process you will be left with a SQLite3
file containing the same information as the giant PDF. But you should not be
confused: Despite being (hopefully) expedient, this is a hilarious, absurd
process. Realize that this data already exists in a database somewhere! The tool
generally tries to be somewhat careful and error out if it is confused, but if
you make crucial business decisions based on data generated by this tool, and
that data turns out to be wrong, you know who to blame. (Not me.)

Once you have the file, I highly recommend
[SQLiteBrowser](https://sqlitebrowser.org/) for analyzing it. By default, the
tool will write `statements.sqlite3`.  If you don't know
[SQL](https://en.wikipedia.org/wiki/SQL), simply try and extrapolate from the
queries below. You'll be right most of the time. Alternatively, I hear the CS
department has a course. :)

It is generally safe to ^C abort the tool. It will either finish completely
or make no modifications. (Yay transactions.)

Here are some queries I've found useful:

*   ```sql
    select * from account;
    ```

    What accounts do I have?

*   How much money have I spent on my startup/ICR account? (`2` is the account ID of my
    startup account.)

    ```sql
    select sum(actual) from trans where in_account_id=2;
    ```

*   How much money has arrived from a funding agency? (3 is an NSF grant account for me)

    ```sql
    select sum(actual) from trans where in_account_id=3 and descr like '%Revenue%';
    ```

*   Who has been paid how much out of account X?

    ```sql
    select name, sum(amount) from payroll where in_account_id=2 group by name order by name;
    ```

*   Who has been paid how much out of account X?
    (broken down by salary, benefits, etc.)

    ```sql
    select name, account_descr, sum(amount)
    from payroll where in_account_id=3
    group by name, account_descr
    order by name, account_descr;
    ```

*   Out of which accounts (and how much) has RA `Lastname` ever been paid?
    (broken down by salary, benefits)

    ```sql
    select fund_descr, account_descr, sum(amount)
    from payroll inner join account on payroll.in_account_id = account.id where name like '%Lastname%'
    group by fund_descr, account_descr
    order by fund_descr, account_descr
    ;
    ```


*   What types of things have my accounts been charged for (and how much)?
    (excluding XPACC)

    ```sql
    select account_descr, sum(actual) from trans
        where in_account_id <> 5 and actual <> 0
        group by account_descr
        order by account_descr
        ;
    ```

*   How much have I spent on IT equipment? (not counting XPACC)

    ```sql
    select sum(actual) from trans where account_descr like 'NC IT Equip%' and actual <> 0 and in_account_id <> 5;
    ```

*   How much have I spent on travel? (myself and students, excluding XPACC)

    ```sql
    select sum(actual) from trans where (
        account_descr like '%Trav%'
        or account_descr like '%Reimb%'
        or account_descr like '%Trvl%'
        or account_descr like '%Veh%'
        ) and account_descr not like '%Non-Emp%'
        and in_account_id <> 5;
    ```

*   How much indirect cost have I paid to the university?  (excluding XPACC)

    ```sql
    select sum(actual) from trans
        where in_account_id <> 5 and actual <> 0
        and account_descr like '%Fac%' and  account_descr like '%Adm%'
        ;
    ```
